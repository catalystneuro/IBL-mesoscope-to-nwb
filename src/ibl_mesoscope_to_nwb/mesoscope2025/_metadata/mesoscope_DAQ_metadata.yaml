# DAQ channel metadata for IBL-Mesoscope sessions
#
# Adapted from https://github.com/h-mayorquin/IBL-to-nwb/blob/4fed77ec79e1b73c31a5c7e927b40e26256ed056/src/ibl_to_nwb/_metadata/nidq.yml
#
# This file contains NWB metadata for DAQ channels, keyed by device name
# as defined in _timeline_DAQdata.meta.json. Channel IDs are determined dynamically from
# _timeline_DAQdata.meta.json at runtime - only device names need to match.
#
# Structure:
#   Events: Digital channel metadata (device_name -> name, description, meanings)
#   TimeSeries: Analog channel metadata (device_name -> name, description)

TimeSeries:
  bpod:
    name: TimeSeriesBpod
    description: >-
      Analog signal from Bpod behavioral control system.
      This continuous voltage signal encodes behavioral state machine events and timestamps
      from the Bpod system, which controls stimulus presentation and reward delivery during tasks.
      The analog encoding allows precise temporal alignment between Bpod events and neural recordings.
    unit: volts

  GalvoX:
    name: TimeSeriesGalvoX
    description: >-
      Analog signal from galvo X-axis position sensor.
      This continuous voltage signal encodes the X-axis position of the galvo scanner in the mesoscope system.
      The galvo scanner controls the horizontal scanning of the imaging field, and this signal allows for precise temporal alignment of galvo position with neural data, enabling correction for motion artifacts and accurate reconstruction of the imaging field over time.
    unit: volts

  GalvoY:
    name: TimeSeriesGalvoY
    description: >-
      Analog signal from galvo Y-axis position sensor.
      This continuous voltage signal encodes the Y-axis position of the galvo scanner in the mesoscope system.
      The galvo scanner controls the vertical scanning of the imaging field, and this signal allows for precise temporal alignment of galvo position with neural data, enabling correction for motion artifacts and accurate reconstruction of the imaging field over time.
    unit: volts

  LaserPower:
    name: TimeSeriesLaserPower
    description: >-
      Analog signal from laser power sensor.
      This continuous voltage signal encodes the power of the excitation laser in the mesoscope system.
      Monitoring laser power is essential for ensuring consistent imaging conditions and for correcting any fluctuations in fluorescence intensity that may arise from changes in laser power during the recording session.
    unit: volts

  RemoteFocus1:
    name: TimeSeriesRemoteFocus1
    description: >-
      Analog signal from remote focus position sensor 1.
      This continuous voltage signal encodes the position of the first remote focus mechanism in the mesoscope system.
      Remote focusing allows for rapid changes in imaging depth, and this signal enables precise temporal alignment of focus position with neural data, facilitating correction for axial motion and accurate reconstruction of the 3D imaging field over time.
    unit: volts

  RemoteFocus2:
    name: TimeSeriesRemoteFocus2
    description: >-
      Analog signal from remote focus position sensor 2.
      This continuous voltage signal encodes the position of the second remote focus mechanism in the mesoscope system.
      Remote focusing allows for rapid changes in imaging depth, and this signal enables precise temporal alignment of focus position with neural data, facilitating correction for axial motion and accurate reconstruction of the 3D imaging field over time.
    unit: volts

  chrono:
    name: TimeSeriesChrono
    description: >-
      Chrono signal from DAQ acquisition system.
      This continuous voltage signal encodes the timing of the DAQ acquisition system's internal clock, providing a reference for aligning all other signals with the neural data recorded by the Neuropixels probes.
      The chrono signal is essential for ensuring precise temporal synchronization across all data streams in the NWB file.
    unit: volts

  photoDiode:
    name: TimeSeriesPhotoDiode
    description: >-
      Photodiode signal from Frame2TTL device.
      This continuous voltage signal encodes changes in screen luminance detected by the photodiode, providing precise timing of visual stimulus presentation on the monitor.
      The photodiode signal is essential for accurate stimulus-response latency measurements and for aligning visual stimuli with neural and behavioral data in the NWB file.
    unit: volts

  photosensor:
    name: TimeSeriesPhotoSensor
    description: >-
      Photosensor signal from Frame2TTL device.
      This continuous voltage signal encodes changes in screen luminance detected by the photosensor, providing precise timing of visual stimulus presentation on the monitor.
      The photosensor signal is essential for accurate stimulus-response latency measurements and for aligning visual stimuli with neural and behavioral data in the NWB file.
    unit: volts

  reward_valve:
    name: TimeSeriesRewardValve
    description: >-
      Analog signal from reward valve control.
      This continuous voltage signal encodes the state of the reward valve (open or closed) during behavioral tasks, allowing for precise temporal alignment of reward delivery events with neural and task data in the NWB file.
    unit: volts

  syncEcho:
    name: TimeSeriesSyncEcho
    description: >-
      Sync echo signal from <...>.
      This continuous voltage signal encodes the timing
      of the synchronization pulses sent by the DAQ system, 
      providing a reference for aligning all other signals with the neural data.
    unit: volts

  left_camera:
    name: TimeSeriesSyncLeftCamera
    description: >-
      This continuous voltage signal encodes the timing
      of the video frame acquisition for the left-side camera.
    unit: volts

  right_camera:
    name: TimeSeriesSyncRightCamera
    description: >-
      This continuous voltage signal encodes the timing
      of the video frame acquisition for the right-side camera.
    unit: volts

  body_camera:
    name: TimeSeriesSyncBodyCamera
    description: >-
      This continuous voltage signal encodes the timing
      of the video frame acquisition for the body camera.
    unit: volts

  frame2ttl:
    name: TimeSeriesSyncFrame2ttl
    description: >-
      This continuous voltage signal encodes the timing
      of the monitor refresh events detected by the photodiode for visual stimulus timing.
      The Frame2TTL device uses a photodiode to detect changes in screen luminance,
      providing precise timing of when visual stimuli are displayed on the monitor.
      This is essential for accurate stimulus-response latency measurements.
    unit: volts

  audio:
    name: TimeSeriesSyncAudio
    description: >-
      This continuous voltage signal encodes the timing
      of the auditory stimulus presentation.
      Marks timing of audio stimulus delivery for auditory tasks or cue presentation.
    unit: volts

Events:
  bpod:
    name: EventsBpod
    description: >-
      Digital events from Bpod behavioral control system.
      Each event marks a state transition in the Bpod state machine, which controls stimulus presentation and reward delivery during tasks.
      The digital encoding allows precise temporal alignment between Bpod events and neural recordings, enabling analysis of neural activity in relation to specific behavioral events.
    meanings:
      bpod_low: Bpod signal LOW (state transition)
      bpod_high: Bpod signal HIGH (state transition)

  left_camera:
    name: EventsLeftCamera
    description: >-
      Video frame acquisition times for the left-side camera (body camera).
      Each event marks when a video frame was captured by the camera,
      enabling temporal alignment of behavior videos with neural and task data.
    meanings:
      exposure_end: Camera exposure end or frame readout complete
      frame_start: Camera frame acquisition start (frame timestamp)

  right_camera:
    name: EventsRightCamera
    description: >-
      Video frame acquisition times for the right-side camera (body camera).
      Each event marks when a video frame was captured by the camera,
      enabling temporal alignment of behavior videos with neural and task data.
    meanings:
      exposure_end: Camera exposure end or frame readout complete
      frame_start: Camera frame acquisition start (frame timestamp)

  body_camera:
    name: EventsBodyCamera
    description: >-
      Video frame acquisition times for the body camera.
      Each event marks when a video frame was captured by the camera,
      enabling temporal alignment of behavior videos with neural and task data.
    meanings:
      exposure_end: Camera exposure end or frame readout complete
      frame_start: Camera frame acquisition start (frame timestamp)

  frame2ttl:
    name: EventsFrame2ttl
    description: >-
      Monitor refresh events detected by photodiode for visual stimulus timing.
      The Frame2TTL device uses a photodiode to detect changes in screen luminance,
      providing precise timing of when visual stimuli are displayed on the monitor.
      This is essential for accurate stimulus-response latency measurements.
    meanings:
      screen_dark: Screen transitioned to dark (photodiode detected low luminance)
      screen_bright: Screen transitioned to bright (photodiode detected high luminance)

  rotary_encoder: #TODO: Why is rotary encoder different from BWM conversion? No quadrature encoding?
    name: EventsRotaryEncoder
    description: >-
      Rotary encoder pulses tracking wheel movement. 
      Each pulse represents a discrete angular increment of the wheel rotation,
      used to measure behavioral responses and locomotion with high temporal precision.
    meanings:
      phase_low: Encoder phase transition to LOW
      phase_high: Encoder phase transition to HIGH

  audio:
    name: EventsAudio
    description: >-
      Auditory stimulus presentation events.
      Marks timing of audio stimulus delivery for auditory tasks or cue presentation.
    meanings:
      audio_off: Audio stimulus off
      audio_on: Audio stimulus on

  neural_frames:
    name: EventsNeuralFrames
    description: >-
      Frame synchronization events for neural data.
      Each event marks the timing of a frame acquisition in the neural recording system,
      allowing for precise temporal alignment of neural data with other data streams in the NWB file.
    meanings:
      frame_low: Neural frame synchronization signal LOW
      frame_high: Neural frame synchronization signal HIGH

  volume_counter:
    name: EventsVolumeCounter
    description: >-
      Volume counter events for mesoscope imaging.
      Each event marks the timing of a volume acquisition in the mesoscope imaging system,
      allowing for precise temporal alignment of imaging data with other data streams in the NWB file.
    meanings:
      volume_low: Volume counter signal LOW
      volume_high: Volume counter signal HIGH
